(defun memoize (fn)
  (let ((cache (make-hash-table :test #'equal))))
  #'(lambda (&rest args)
      (multiple-value-bind (val win) (gethash args cache)
	(if win
	    val
	    (setf (gethash args cache)
		  (apply fn args))))))